<!DOCTYPE html>
<html lang="ja" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Honcari -気軽に本をどこへでも-</title>
<!-- Style CSS -->
<link href="../static/css/bootstrap.css" th:href="@{/css/bootstrap.css}" rel="stylesheet">
<link rel="stylesheet" href="../static/css/style.css" th:href="@{/css/style.css}">
</head>
<body>
<header>
	<nav th:replace="header::frag_header(0)"></nav>
</header>

<!-- page content -->
<div class="container">
	<div class="row">
		<div class="w-100 mx-auto">
			<h1 class="my-4">レンタル管理</h1>

			<!-- side bar -->
			<div th:replace="mypage_side_menu::frag_mypage_side_menu(3)"></div>

<!-- main content -->
<div class="py-5 book-detail-wrapper">
    <div class="container">
    	<!-- タブ・メニュー -->
	    <ul class="nav nav-tabs nav-justified justify-content-center">
  			<li class="nav-item">
    			<a class="nav-link text-dark" href="#borrowing-list" data-toggle="tab">借りてる本</a>
 	 		</li>
 	 		<li class="nav-item">
   				 <a class="nav-link text-dark" href="#lending-list" data-toggle="tab">貸してる本</a>
  			</li>
    	</ul>
    	<!-- タブ・コンテント -->
   		<div class="tab-content">
   			<div class="tab-pane active" id="borrowing-list" >
   				<!-- レンタル承認待ち -->
   				<div class="pt-3 pb-3 mt-4 mb-4 border-bottom">
   			 		<div th:if="${borrowPendingList.size()}==0"><p class="text-center">申請中の本はありません</p></div>
					<div class="mt-3 mb-3" th:each="bookRental:${borrowPendingList}">
						<div class="row">
				  			<div class="col-lg-6">
								<img th:src="@{${bookRental.ownedBookInfo.book.thumbnailPath}}" class="rounded img-fluid mx-auto d-block book-detail">
							</div>
							<div class="col-lg-6">
								<div class="text-box">
									<form th:action="@{/book_rental/cancel}" method="POST">	
									書籍名：<span th:text="${bookRental.ownedBookInfo.book.title}"></span><br>
									所有者：<span th:text="${bookRental.ownedBookInfo.user.name}">さん</span><br>
									レンタル希望期間：<span th:text="${bookRental.deadline}">まで</span><br>
									ステータス：<span th:text="${bookRental.ownedBookInfo.getStatus()}"></span>
									<input type="hidden" th:value="${bookRental.bookRentalId}" name="bookRentalId">
									<div><button class="cancel-btn btn btn-primary btn-sm" type="submit">キャンセル</button></div>
									</form>
								</div>
							</div>
						</div>
					</div>
				</div>
				<!-- レンタル中 -->
				<div class="mt-3 mb-3" th:each="bookRental:${borrowList}">
					<div class="row">
						<div class="col-lg-6">
							<img th:src="@{${bookRental.ownedBookInfo.book.thumbnailPath}}" class="rounded img-fluid mx-auto d-block book-detail">
						</div>
						<div class="col-lg-6">
							<div class="text-box">
								<form th:action="@{#}" method="POST">	
								書籍名：<span th:text="${bookRental.ownedBookInfo.book.title}"></span><br>
								所有者：<span th:text="${bookRental.ownedBookInfo.user.name}">さん</span><br>
								レンタル希望期間：<span th:text="${bookRental.deadline}">まで</span><br>
								ステータス：<span th:text="${bookRental.ownedBookInfo.getStatus()}"></span>
								<input type="hidden" th:value="${bookRental.bookRentalId}" name="bookRentalId">
								<div><button class="btn btn-primary btn-sm" type="submit">延長申請</button></div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="tab-pane" id="lending-list">
				<!-- 貸出承認待ち -->
		      <div class="pt-3 pb-3 mt-4 mb-4 border-bottom">
				<div th:if="${lendPendingList.size()}==0"><p class="text-center">申請中の本はありません</p></div>
				<div class="mt-3 mb-3" th:each="bookRental:${lendPendingList}">
					<div class="row">
						<div class="col-lg-6">
							<img th:src="@{${bookRental.ownedBookInfo.book.thumbnailPath}}" class="rounded img-fluid mx-auto d-block book-detail">
						</div>
						<div class="col-lg-6">
							<div class="text-box">
								<form th:action="@{/book_rental/accept}" method="POST">
								書籍名：<span th:text="${bookRental.ownedBookInfo.book.title}"></span><br>
								レンタル希望者：<span th:text="${bookRental.ownedBookInfo.user.name}">さん</span><br>
								レンタル希望期間：<span th:text="${bookRental.deadline}">まで</span><br>
								ステータス：<span th:text="${bookRental.ownedBookInfo.getStatus()}"></span>
								<input type="hidden" th:value="${bookRental.bookRentalId}" name="bookRentalId">
								<div><button class="approval-btn btn btn-warning btn-sm" type="submit">承認</button></div>
								</form>
							</div>
						</div>
					</div>
				  </div>
				</div>
				<!-- 貸出中 -->
				<div class="mt-3 mb-3" th:each="bookRental:${lendList}">
					<div class="row">
						<div class="col-lg-6">
							<img th:src="@{${bookRental.ownedBookInfo.book.thumbnailPath}}" class="rounded img-fluid mx-auto d-block book-detail">
						</div>
						<div class="col-lg-6">
							<div class="text-box">
								書籍名：<span th:text="${bookRental.ownedBookInfo.book.title}"></span><br>
								レンタル希望者：<span th:text="${bookRental.ownedBookInfo.user.name}">さん</span><br>
								レンタル希望期間：<span th:text="${bookRental.deadline}">まで</span><br>
								ステータス：<span th:text="${bookRental.ownedBookInfo.getStatus()}"></span>
								<div><button class="btn btn-warning btn-sm" data-toggle="modal" data-target="#return-confirm-form">返却確認</button></div>
							</div>
						</div>
					</div>
					<!-- Modal -->
					<div class="modal fade" id="return-confirm-form" tabindex="-1" role="dialog">
  						<div class="modal-dialog modal-dialog-centered" role="document">
 							<div class="modal-content">
 							  <form method="post" th:action="@{/book_rental/confirm_return}">
 							   <div class="modal-header">
  							   		<h5 class="modal-title">本の貸出状況を選択</h5>
  						    	  	<button type="button" class="close" data-dismiss="modal" aria-label="Close">
  					        			<span aria-hidden="true">&times;</span>
  						       		</button>
  					     	   </div>
   							   <div class="modal-body">
   								    <input type="radio" name="updateStatus" th:value="0">&nbsp;貸出不可&nbsp;&nbsp;
   								    <input type="radio" name="updateStatus" th:value="1">&nbsp;貸出可
   								    <input type="hidden" th:value="${bookRental.bookRentalId}" name="bookRentalId">
  	 						   </div>
    						  	<div class="modal-footer">
    								<button type="button" class="btn btn-secondary" data-dismiss="modal">閉じる</button>
    								<button type="submit" class="btn btn-primary">リクエストを送信</button>
  							  	</div>
  							  </form>
  							</div>
  						</div>	
					</div>
				</div>
			</div>
   		  </div>
    </div>
</div>

		</div>
	</div>
</div>
	<script	src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="../static/js/bootstrap.js" th:src="@{/js/bootstrap.js}"></script>
	<script th:inline="javascript">
	  (function(){
		  'use strict';
		  $('.cancel-btn').click(function() {
			  if(!confirm("キャンセルしてよろしいでしょうか?")){
				  return false;
			  }
		  });
		  $('.approval-btn').click(function() {
			  if(!confirm("承認してよろしいでしょうか?")){
				  return false;
			  }
		  });
	  })();
	</script>
</body>
</html> 